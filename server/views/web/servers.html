<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web Server Dasboard</title>
    <link rel="icon" type="image/x-icon" href="favicon.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
  </head>
  <style>
    :root {
      --bd-purple: #4c0bce;
      --bd-violet: #712cf9;
      --bd-accent: #ffe484;
      --bd-violet-rgb: 112.520718, 44.062154, 249.437846;
      --bd-accent-rgb: 255, 228, 132;
      --bd-pink-rgb: 214, 51, 132;
      --bd-teal-rgb: 32, 201, 151;
      --docsearch-primary-color: var(--bd-violet);
      --docsearch-logo-color: var(--bd-violet);
    }
    .bd-navbar {
      padding: 0.75rem 0;
      background-color: transparent;
      background-image: linear-gradient(
        to bottom,
        rgba(var(--bd-violet-rgb), 1),
        rgba(var(--bd-violet-rgb), 0.95)
      );
      box-shadow: 0 0.5rem 1rem rgb(0 0 0 / 15%),
        inset 0 -1px 0 rgb(0 0 0 / 15%);
      margin-bottom: 10px;
    }
    .sticky-top {
      position: -webkit-sticky;
      position: sticky;
      top: 0;
      z-index: 1020;
    }
  </style>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bd-navbar sticky-top">
      <div class="text-center text-light fs-4">Web Server Dashboard</div>
    </header>
    <div class="col">
      <div class="col-md-6 offset-md-3">
        <ul class="list-group">
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            Simple Web Server
            <div class="col-3">
              <button
                type="button"
                class="btn btn-primary"
                name="start_server1"
                id="start_server1"
              >
                <i class="bi bi-boxes"></i> Start
              </button>
              <button
                type="button"
                class="btn btn-danger"
                name="stop_server1"
                id="stop_server1"
              >
                <i class="bi bi-x-octagon"></i> Stop
              </button>
            </div>
          </li>
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            Token Web Server
            <span class="badge bg-primary rounded-pill">2</span>
          </li>
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            Bug Web Server
            <span class="badge bg-primary rounded-pill">1</span>
          </li>
        </ul>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
      integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
      integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      function urlExists(url) {
        $.ajax({
          timeout: 5000,
          type: "GET",
          dataType: "jsonp",
          url: "http://" + url,
          cache: false,
          error: function (XMLHttpRequest, textStatus, errorThrown) {
            if (errorThrown == "timeout") {
              result.push({
                url: url,
                status: "woah, there we got a timeout...",
              });
              // At this point the request shall abort
            }
            // if (errorThrown == "error") {
            //   result.push({
            //     url: url,
            //     status: "Connection refused",
            //   });
            //   $("#stop_server1").attr("disabled", true);
            //   $("#start_server1").attr("disabled", true);
            // }
          },
          complete: function () {
            // Handle the complete event
            if (result.length == list.length) {
              alert(
                "All url's checked. Check the console for 'result' varialble"
              );
            }
            if (result.status == "listening") {
              alert("Server already running...");
            }
          },
          statusCode: {
            404: function () {
              result.push({
                url: url,
                status: "404!",
              });
              $("#stop_server1").attr("disabled", true);
              $("#start_server1").attr("disabled", false);
            },
            0: function () {
              result.push({
                url: url,
                status: "0!",
              });
            },
            500: function () {
              result.push({
                url: url,
                status: "500",
              });
            },
            200: function () {
              result.push({
                url: url,
                status: "it worked!",
              });
              $("#stop_server1").attr("disabled", false);
              $("#start_server1").attr("disabled", true);
            },
          },
        });
      }
      var result = new Array();
      var list = ["172.16.54.155:4040"];
      $(document).ready(function () {
        console.log("ready!");

        for (var i = list.length - 1; i >= 0; i--) {
          urlExists(list[i]);
        }
      });

      $("#start_server1").click(function () {
        if ($(this)[0].disabled == false) {
          $.ajax({
            url: window.location.href + "/simpleserver/start",
            success: function (result) {
              if (result.success == "connected") {
                $("#start_server1").attr("disabled", true);
                $("#stop_server1").attr("disabled", false);
              }
            },
          });
        }
      });
      $("#stop_server1").click(function () {
        $.ajax({
          url: window.location.href + "/simpleserver/stop",
          success: function (result) {
            if (result.success == "disconnected") {
              $("#start_server1").attr("disabled", false);
              $("#stop_server1").attr("disabled", true);
            }
          },
        });
      });
    </script>
  </body>
</html>
